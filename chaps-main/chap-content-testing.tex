\chapter{Final Walking Test}
    The final walking tests are comprised of three different terrains: a simple flat plane as a baseline, then a staircase to demonstrate simple foot and body height adjustment, and finally a uneven organic like surface.
    
    % When presenting testing data, a snapshot of the 3D simulation environment will be shown, with the body and foot paths traced. Additionally key data points
    % are also graphed, however only the height of a single foot will be graphed, this is to maintain clarity.

    \section{Flat Terrain}
    The flat plane test aims to quantify nominal body height oscillations and to provide a baseline to compare subsequent test to. The test was performed with a nominal stride length of 15cm, while the flow function parameters \(Ch\) and \(q\) were set to 2.0 and 14.0 respectively. This equates to a desired step height roughly equal to true stride lenght, which is dependant on the terrain. The target body height was set to \(9cm\) above the terrain. The only commands given to the robot was to walk forwards at a consant speed. Figure \ref{fig:plane_test} shows screenshots of the simulation test being performed in \ac{mujoco}. A video of the simulation can be seen \hyperlink{}{here}.

    \newpage
    \begin{figure}[h]
        \centering
        \includegraphics[width=.7\textwidth]{WalkTestPlane.png}
        \includegraphics[width=.7\textwidth]{WalkTestPlaneTop.png}
        \caption{Flat plane walk test}
        \label{fig:plane_test}
    \end{figure}
    \begin{figure}[h]
        \centering
        \includegraphics{data_plane.pdf}
        \caption{Body height (top). Body tilt (center). Position of one foot (bottom)}
        \label{fig:plane_test_data}
    \end{figure}
    
    \noindent
    The simulation results are show in Figure \ref{fig:plane_test_data}. It can be seen that the stride length is roughly equal to the set stride of \(15cm\). The step height is roughly \(10cm\) which is lower than 
    
    It can be seen that there is a constant error of about 1cm in the body height of the robot. The reason for this is that there is no body height feedback control, as such, errors in the servos accumulate to result in the body height error. This can be easily solved by adding a constant offset or by adding feedback control for the body height. It is also clear that as the robot walks there are some oscillations in the body height. This is to be expected as the servos are not modeled as having infinite torque, thus, the robot will sag when three legs are lifted off the ground, and rebound once those legs are placed on the floor again. Similarly to the body height error, adding feedback control on the body height would reduce these oscillations. The amplitude of the oscillations are lower than the \(10\%\) of the desired body height, which is acceptable. 

    Next, it can be seen that the tilt of the body also exhibit small oscillations, in both roll and pitch. However, the amplitudes of these oscillations remain below 0.5 degrees. Finally, the height of one of the legs are shown, from this it is clear that the robot takes uniform, stable steps.

    \newpage
    \section{Staircase}
    The staircase test demonstrates the ability of the robot to adjust the height of its feet in order to maintain a level body,
    additionally the ability of the robot to automatically adjust its height relative to the floor is also demonstrated. A 3D image
    of this test can be seen in figure \ref{fig:stairs_test} and the data plots in figure \ref{fig:stairs_test_data}.
    \begin{figure}[h]
        \centering
        \includegraphics[width=.8\textwidth]{WalkTestStairts.png}
        \includegraphics[width=.8\textwidth]{WalkTestStairtsTop.png}
        \caption{Stairs walk test}
        \label{fig:stairs_test}
    \end{figure}
    \begin{figure}[h]
        \centering
        \includegraphics{data_stairs.pdf}
        \caption{Body height (top). Body tilt (center). Position of one foot (bottom)}
        \label{fig:stairs_test_data}
    \end{figure}

    \noindent
    Similarly to the flat plane test, as expected, the constant body height error is still present.
    However, from this test it can be seen in figure \ref{fig:stairs_test_data} that the robot does increase its height to maintain a constant
    height above the terrain. It is clear that the body height is not increased in the four discrete steps as the stairs do, rather the
    body height is increased more smoothly using many smaller steps. This is thanks to the system described in section \ref{sec:height_adjust}.

    Body tilt, while more prominent than in the flat plane test, is still quite low as it largely stays below \(1.0^\circ\), with intermittent jumps approaching \(2.0^\circ\).
    This is still within the specifications, and as previously stated could easily be improved by incorporating accelerometer based feedback control on the foot height.

    \noindent
    Finally, the foot height plot clearly shows how one of the feet of the robot adjusts its height and step arc based on the terrain. Otherwise the foot arc looks very similar to that of the
    flat plane test, which is optimal.
    
    \newpage
    \section{Organic}
    The organic test aims to show how the robot can place feet on an appropriate spot on the terrain, while maintaining level and a certain height. Figure \ref{fig:org_test} shows the
    3D view of the test.
    \captionsetup[figure]{oneside,margin={0.9cm,0cm}}
    \begin{figure}[h]
        \centering
        \includegraphics[width=.8\textwidth]{WalkTestOrg.png}
        \includegraphics[width=.8\textwidth]{WalkTestOrgTop.png}
        \caption{Organic walk test.}
        \label{fig:org_test}
    \end{figure}
    \begin{figure}[h]
        \centering
        \includegraphics{cobble_test_feet.pdf}
        \caption{Feet top view (Top). Feet side view (Bottom)}
        \label{fig:org_test_data}
    \end{figure}
    \begin{figure}[h]
        \centering
        \includegraphics{cobble_test_body.pdf}
        \caption{Body height (Top). Body tilt (Bottom)}
        \label{fig:org_test_data}
    \end{figure}

    \noindent
    From figure \ref{fig:org_test_data} it can be seen that the body height error seen in the flat plane test
    is still present and more severe. But the body does stay within a reasonable margin from the desired height.

    For most part the body tilt is similar to that of the stairs test, however more frequent and more sever spikes are present.
    This is due, in part, to the more erratic mismatch between the body height and the requested body heigh. The horizontal adjustments made to 
    the foot end positions cause the swinging feet to end their steps at different times, this is the primary cause of the tilt spikes, as when one
    foot is placed on the floor before the other two, the robot is tilted slightly. This, however, would not occur if there was no, or little, 
    error in the body height.

    Finally, when looking at the foot position plot in figure \ref{fig:org_test_data}, please note that the plot is a projection into the X-Z plane, and thus any
    adjustment made in the Y-axis is not shown, the foot shown has been chosen to include minimum Y-axis variation. 
    Thus, please also see the 3D view in figure \ref{fig:org_test}. From these two figures it is clear that the foot end positions are, in addition to height,
    adjusted in the horizontal plane, the step arcs are appropriately adjusted and remain relatively smooth, similar to the flat plane test.


% \bigskip
% \bigskip
% \hrule
% \smallbreak
% \hrule
